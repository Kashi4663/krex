{% extends 'base.html' %}
{% block content %}

<style>
body {
    padding-top: 0 !important;
}

/* ================= HERO ================= */

.movie-hero {
    position: relative;
    margin-top: 0px;
    height: 100vh;
}

.hero-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.hero-overlay {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        to top,
        rgba(0,0,0,0.85) 0%,
        rgba(0,0,0,0.5) 40%,
        rgba(0,0,0,0.1) 80%
    );
    top: 0;
    left: 0;
}

.hero-content {
    position: absolute;
    top: 57%;
    left: 5.2%;
    color: white;
    font-size: 20px;
    font-weight: bold;
    z-index: 2;
}

/* ================= BUTTONS ================= */

.custom-btn78 {
    padding: 12px 30px;
    font-size: 25px;
    font-weight: bold;
    background: rgba(57, 56, 56, 0.54);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    position: absolute;
    top: 85%;
    left: 4.8%;
    height: 60px;
    z-index: 2;
}

.custom-btn79 {
    padding: 12px 30px;
    font-size: 25px;
    font-weight: bold;
    background: rgba(57, 56, 56, 0.54);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    position: absolute;
    top: 85%;
    left: 16%;
    height: 60px;
    z-index: 2;
}

.custom-btn80,
.custom-btn81,
.custom-btn82 {
    width: 65px;
    height: 65px;
    font-size: 25px;
    background: rgba(57, 56, 56, 0.54);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    position: absolute;
    top: 84.7%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
}

.custom-btn80 { left: 26%; }
.custom-btn81 { left: 30%; }
.custom-btn82 { left: 34%; }

.custom-btn83 {
    width: 65px;
    height: 65px;
    font-size: 22px;
    background: rgba(57, 56, 56, 0.54);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    position: absolute;
    top: 84.7%;
    left: 38%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
}

.custom-btn83.active {
    background: white;
    color: black;
}

/* ================= EPISODES ================= */

#episodesSection {
    margin-top: 60px;
    padding: 0 25px;
}

.episode-item {
    display: flex;
    gap: 20px;
    margin-bottom: 25px;
    background: #111;
    padding: 15px;
    border-radius: 10px;
}

.episode-item img {
    width: 200px;
    border-radius: 10px;
}

/* ================= RELATED ================= */

#relatedSection {
    margin-top: 60px;
    padding: 0 25px;
}

.movie-row {
    display: flex;
    gap: 20px;
    overflow-x: auto;
    padding-bottom: 30px;
}

.movie-card img {
    width: 200px;
    border-radius: 10px;
}

     footer {
    background: rgba(9, 157, 190, 0.25);
    color: white;
    text-align: center;
    width: 100%;
    padding: 40px 0;
    margin: 0;
    position: absolute;
    top:250.6%;
}

        nav a.home {color: black;}

        /* Reset everything */


footer a {
    color: #00aaff;       /* Blue color */
    text-decoration: none;  /* Removes underline */
    font-weight: 500;
    transition: 0.3s ease;
}

footer a:hover {
    color: #66d9ff;       /* Lighter blue on hover */
    text-decoration: none;
}

</style>


<div class="movie-hero">

   {% if show.trailer %}
    <video class="hero-video" autoplay muted loop playsinline>
        <source src="{{ show.trailer.url }}" type="video/mp4">
    </video>
   {% endif %}

    <div class="hero-overlay"></div>

    <div class="hero-content">
        <h1>{{ show.title }}</h1>
        <p>{{ show.description }}</p>
        <p><strong>Language:</strong> {{ show.language }}</p>
        <p><strong>Year:</strong> {{ show.release_year }}</p>
    </div>

    {% if show.video %}
    <a href="{% url 'watch_episode' show.episodes.first.id %}">
        <button class="custom-btn78">Watch Now</button>
    </a>
    {% endif %}

    {% if show.more_info_link %}
    <a href="{{ show.more_info_link }}" target="_blank">
        <button class="custom-btn79">More Info</button>
    </a>
    {% endif %}

    <a href="{% url 'toggle_tvshow_watchlist' show.id %}">
        <button class="custom-btn80">
            {% if in_watchlist %} âœ“ {% else %} + {% endif %}
        </button>
    </a>

    <button class="custom-btn81">
        <i class="fa-regular fa-thumbs-up"></i>
    </button>

    <button class="custom-btn82">
        <i class="fa-regular fa-thumbs-down"></i>
    </button>

    <button class="custom-btn83 active" id="episodesBtn">
        <i class="fa-solid fa-list"></i>
    </button>

</div>


<!-- ================= EPISODES ================= -->

<div id="episodesSection">

    <h2 class="section-title">Episodes</h2>

    {% regroup show.episodes.all by season as season_list %}

    {% for season in season_list %}
        <h3 style="margin-top:30px;">Season {{ season.grouper }}</h3>

        {% for episode in season.list %}
            <div class="episode-item">

                {% if episode.thumbnail %}
                    <img src="{{ episode.thumbnail.url }}">
                {% endif %}

                <div>
                    <h4>
                        S{{ episode.season|stringformat:"02d" }}E{{ episode.episode_number|stringformat:"02d" }}
                        - {{ episode.title }}
                    </h4>
                    <p>{{ episode.description }}</p>

                    <a href="{% url 'episode_detail' episode.id %}">
    <button style="padding:8px 20px; background:red; color:white; border:none; border-radius:5px;">
        View Episode
    </button>
</a>
                </div>

            </div>
        {% endfor %}
    {% endfor %}

</div>


<!-- ================= RELATED ================= -->

<div id="relatedSection">

    <h2 class="section-title" style="margin-top:60px;">
        Customers also watched
    </h2>

    <div class="movie-row">
        {% for related in related_shows %}
            <div class="movie-card">
                <a href="{% url 'shows_detail' related.id %}">
                    <img src="{{ related.poster.url }}" alt="{{ related.title }}">
                </a>
                <h3>{{ related.title }}</h3>
            </div>
        {% endfor %}
    </div>

</div>


<script>
const episodesBtn = document.getElementById("episodesBtn");
const episodesSection = document.getElementById("episodesSection");
const relatedSection = document.getElementById("relatedSection");

episodesBtn.addEventListener("click", function () {

    const isVisible = window.getComputedStyle(episodesSection).display !== "none";

    if (isVisible) {
        episodesSection.style.display = "none";
        relatedSection.style.display = "block";
        episodesBtn.classList.remove("active");
    } else {
        episodesSection.style.display = "block";
        relatedSection.style.display = "none";
        episodesBtn.classList.add("active");
    }

});
</script>

{% endblock %}